#!/usr/bin/env ruby

require 'fileutils'

ROOT_PATH = File.expand_path("#{__dir__}/../src")

Dir.glob(ROOT_PATH + '/**/*.bf').each do |file|
  begin
    tmp = ROOT_PATH + '/.current.tmp'
    puts file
    File.open(tmp, 'w') do |output|
      File.open(file, 'r') do |input|
        characters = []
        characters += input.read(2560).scan(/./) until input.eof?
        characters = characters.reject { |char| char == "\n" }
        characters = characters.each_slice(80).map { |s| s.join("") }
        output.write(characters.join("\n"))
      end
    end
    FileUtils.mv(tmp, file)
  ensure
    FileUtils.rm(tmp) if File.exist?(tmp)
  end
end
